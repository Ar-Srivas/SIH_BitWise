{% extends "template.html" %}

{% block title %}Student Dashboard - EduHelp Pro{% endblock %}

{% block dashboard_active %}dark:bg-gray-700 dark:text-white bg-[#ff8066]/20 text-[#ff8066]{% endblock %}

{% block page_icon %}EH{% endblock %}
{% block page_title %}Student Dashboard{% endblock %}
{% block page_description %}Welcome back! Ready to continue your learning journey?{% endblock %}

{% block tab_navigation %}
<div class="flex items-center space-x-3 sm:mt-7 mt-4">
    <a href="#" class="px-3 border-b-2 border-[#ff8066] text-[#ff8066] dark:text-white dark:border-white pb-1.5">Overview</a>
    <a href="#" class="px-3 border-b-2 border-transparent text-gray-600 dark:text-gray-400 pb-1.5">Assessments</a>
    <a href="#" class="px-3 border-b-2 border-transparent text-gray-600 dark:text-gray-400 pb-1.5 sm:block hidden">Results</a>
    <a href="#" class="px-3 border-b-2 border-transparent text-gray-600 dark:text-gray-400 pb-1.5 sm:block hidden">Progress</a>
</div>
{% endblock %}

{% block content %}
<!-- Quick Actions Section -->
<div class="mb-8">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
        <span class="mr-2">âš¡</span>
        Quick Actions
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer" onclick="document.getElementById('take-quiz-btn').click()">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-[#ff8066]/20 dark:bg-[#ff8066]/30 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-[#ff8066]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">Take Assessment</h3>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Start a new quiz to test your knowledge and track your progress</p>
            <button id="take-quiz-btn" class="w-full bg-[#ff8066] text-white px-4 py-2 rounded-md hover:bg-[#ff9a80] transition-colors">Start Quiz</button>
        </div>

        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer" onclick="goToRecommendations()">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">Get Recommendations</h3>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Discover personalized learning resources based on your performance</p>
            <button class="w-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">View Recommendations</button>
        </div>

        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer" onclick="goToSlotBooking()">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-4 12v-4m0-4h4m-4 0H8m5 0a5 5 0 11-10 0 5 5 0 0110 0z"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">Book Slots</h3>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Schedule one-on-one sessions with teachers and mentors</p>
            <button class="w-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">Book Slots</button>
        </div>

        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer" onclick="goToChat()">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-orange-100 dark:bg-orange-900 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">ChatBot</h3>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Get instant help and answers to your academic questions</p>
            <button class="w-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">Chat Now</button>
        </div>

        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer" onclick="goToPrediction()">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">Admission Chances</h3>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Predict your chances of getting into university based on your academic performance</p>
            <button class="w-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">Predict</button>
        </div>

        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer" onclick="goToAcademic()">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">Academic Resources</h3>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Find official documentation and video tutorials for learning</p>
            <button class="w-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">Browse Resources</button>
        </div>
    </div>
</div>

<!-- Quiz Results Section -->
<div class="mb-8">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
        <span class="mr-2">ðŸ“Š</span>
        Recent Quiz Results
    </h2>
    <div id="quiz-results" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="animate-pulse">
            <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-3/4 mb-2"></div>
            <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-1/2"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
let userEmail = '';

document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    userEmail = urlParams.get('email');

    if (!userEmail) {
        location.href = '/';
        return;
    }

    const greeting = document.getElementById('greeting');
    if (greeting) {
        const hour = new Date().getHours();
        if (hour < 12) {
            greeting.textContent = "Good morning!";
        } else if (hour < 18) {
            greeting.textContent = "Good afternoon!";
        } else {
            greeting.textContent = "Good evening!";
        }
    }

    const quizButton = document.getElementById('take-quiz-btn');
    if (quizButton) {
        quizButton.onclick = function() {
            location.href = `/quiz?email=${userEmail}`;
        };
    }

    loadQuizResults();
});

function loadQuizResults() {
    fetch(`/api/profile?email=${userEmail}`)
        .then(response => response.json())
        .then(data => {
            const resultsContainer = document.getElementById('quiz-results');
            if (resultsContainer && data.quiz_results && Object.keys(data.quiz_results).length > 0) {
                const resultsHtml = Object.entries(data.quiz_results)
                    .map(([category, count]) => `
                        <div class="flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-700 last:border-b-0">
                            <span class="font-medium">${category}</span>
                            <span class="text-[#ff8066] font-bold">${count}</span>
                        </div>
                    `).join('');
                resultsContainer.innerHTML = `<div class="space-y-2">${resultsHtml}</div>`;
            } else if (resultsContainer) {
                resultsContainer.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-gray-600 dark:text-gray-400">No quiz results available yet. Take your first assessment!</p>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error loading quiz results:', error);
            const resultsContainer = document.getElementById('quiz-results');
            if (resultsContainer) {
                resultsContainer.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-gray-600 dark:text-gray-400">No quiz results available yet. Take your first assessment!</p>
                    </div>
                `;
            }
        });
}
{% endblock %}