{% extends "template.html" %}

{% block title %}My Profile - EduHelp Pro{% endblock %}

{% block profile_active %}dark:bg-gray-700 dark:text-white bg-[#ff8066]/20 text-[#ff8066]{% endblock %}

{% block page_icon %}ðŸ‘¤{% endblock %}
{% block page_title %}My Profile{% endblock %}
{% block page_description %}Your personal information and learning statistics{% endblock %}

{% block tab_navigation %}
<div class="flex items-center space-x-3 sm:mt-7 mt-4">
    <a href="#" class="px-3 border-b-2 border-[#ff8066] text-[#ff8066] dark:text-white dark:border-white pb-1.5">Profile</a>
    <a href="#" class="px-3 border-b-2 border-transparent text-gray-600 dark:text-gray-400 pb-1.5">Statistics</a>
</div>
{% endblock %}

{% block content %}
<div id="profile-content" class="space-y-4">
    <p class="text-gray-600 dark:text-gray-400">Loading your profile...</p>
</div>
{% endblock %}

{% block page_scripts %}
let userEmail = '';

document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    userEmail = urlParams.get('email');

    if (!userEmail) {
        location.href = '/';
        return;
    }

    loadProfile();
});

function loadProfile() {
    fetch(`/api/profile?email=${userEmail}`)
        .then(response => response.json())
        .then(data => {
            const profileContent = document.getElementById('profile-content');

            let quizResultsHtml = '';
            if (data.quiz_results && Object.keys(data.quiz_results).length > 0) {
                quizResultsHtml = Object.entries(data.quiz_results)
                    .map(([category, count]) => `
                        <p class="border-l-4 border-[#ff8066] pl-2 py-1 mb-1 bg-white dark:bg-gray-800 rounded-sm">
                            <strong>${category}:</strong> ${count}
                        </p>
                    `).join('');
            } else {
                quizResultsHtml = `
                    <p class="border-l-4 border-[#ff8066] pl-2 py-1 bg-white dark:bg-gray-800 rounded-sm">No quiz results yet</p>
                `;
            }

            profileContent.innerHTML = `
                <div class="space-y-4">
                    <div class="border-l-4 border-[#ff8066] p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm">
                        <p class="font-medium"><strong>Name:</strong> ${data.name}</p>
                    </div>
                    <div class="border-l-4 border-[#ff8066] p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm">
                        <p class="font-medium"><strong>Email:</strong> ${data.email}</p>
                    </div>
                    <div class="border-l-4 border-[#ff8066] p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm">
                        <h3 class="font-semibold mb-2">Quiz Results Summary</h3>
                        <div class="flex flex-col gap-2">
                            ${quizResultsHtml}
                        </div>
                    </div>
                </div>
            `;
        })
        .catch(error => {
            console.error('Error loading profile:', error);
            document.getElementById('profile-content').innerHTML = `
                <p class="border-l-4 border-[#ff8066] pl-2 py-1 bg-white dark:bg-gray-800 rounded-sm">
                    Failed to load profile. Please try again later.
                </p>
            `;
        });
}
{% endblock %}